---
alwaysApply: true
---

# ÔøΩ LINKART ‚Äî APP FLOW DOCUMENT

## ÔøΩ 1. APP OVERVIEW

**Nom :** Linkart
**Type :** Marketplace mobile pour la musique
**Objectif :** Permettre aux cr√©ateurs (beatmakers, ing√©nieurs sons, studios, artistes) de vendre et d‚Äôacheter des beats, kits et services via une app simple, s√©curis√©e et mon√©tisable.
**Business model :**

* Commission : **5 %** par transaction (beats/kits uniquement).
* Services : **Gratuits** (pas de commission).
* Boosts payants (produits et profils).

---

## ÔøΩ 2. CORE PRINCIPLES

* Un seul type d‚Äôutilisateur avec **capabilities dynamiques** (`can_sell`, `can_buy`, `can_offer_services`, etc.).
* Mobile-first (React Native + Supabase + R2).
* Tous les fichiers stock√©s sur **Cloudflare R2** (presigned URLs only).
* Chaque transaction = contrat PDF + t√©l√©chargement limit√© (beats/kits).
* Services = r√©servation gratuite + paiement externe.
* Aucune vente hors plateforme n'est encourag√©e (protection vendeur/acheteur).
* Messagerie conditionnelle : chat uniquement pour services.
* **Syst√®me de favoris** : HeartIcon sur Product Cards et Mini Player.
* **Playlists √©ditoriales** : Cr√©√©es par admin, lecture par users.
* MVP = simplicit√© + fiabilit√©.

---

## ÔøΩ 3. USER LIFECYCLE FLOW

### ÔøΩ 3.1 ONBOARDING

1. **Splash Screen** ‚Üí logo + tagline.
2. **Sign In / Sign Up**

   * Auth via t√©l√©phone (OTP Supabase).
   * Si nouveau user ‚Üí cr√©ation profil minimal (`name`, `bio`, `location`).
3. **Capabilities par d√©faut** :

   ```json
   {
     "can_buy": true,
     "can_sell": false,
     "can_offer_services": false,
     "can_withdraw": false
   }
   ```
4. Redirection vers **Home (Marketplace)**.

---

### ÔøΩ 3.2 HOME / MARKETPLACE

* Liste pagin√©e de produits actifs (beats, kits, services).
* Filtres : genre, prix, licence, type.
* Barre de recherche (par nom ou tag).
* **Produits boost√©s** affich√©s en priorit√©.
* Chaque carte contient :

  * Image ou waveform
  * Nom, prix, licence
  * Preview (30 s max)
  * Bouton "Acheter" (beats/kits) ou "R√©server" (services)
  * Bouton "Voir profil"

---

### ÔøΩ 3.3 PRODUCT DETAIL

* Page d√©di√©e avec :

  * Player (preview)
  * Infos (BPM, genre, type, licence, prix)
  * Profil vendeur
  * Avis / √©valuations
  * Bouton "Acheter maintenant" (beats/kits) ou "R√©server" (services)
* Si `user.can_buy === false` ‚Üí afficher ‚ÄúVous devez activer votre compte pour acheter‚Äù.

---

### ÔøΩ 3.4 CHECKOUT FLOW (Beats & Kits uniquement)

1. **Choix paiement** : Wave ou Orange Money.
2. **R√©sum√© commande** : titre, prix, commission affich√©e, total.
3. **Paiement** :

   * App ‚Üí `/api/pay`
   * Backend ‚Üí cr√©e `transaction` (status = `pending`)
   * Apr√®s validation mobile money :

     * `status = paid`
     * Calcul commission 5 %
     * G√©n√©ration PDF contrat
     * G√©n√©ration presigned URL pour download
     * Ajout du montant net au `wallet` vendeur
4. **√âcran de confirmation** :

   * Message : "Merci ! Votre achat est confirm√©."
   * Bouton "T√©l√©charger"
   * Affichage contrat PDF (licence)

---

### ÔøΩ 3.4bis SERVICE BOOKING FLOW (Services uniquement)

1. **S√©lection service** : choix du prestataire et du type de service.
2. **Consultation tarifs** : prix fixe, √† la demande, ou multi-tarifs.
3. **Demande de r√©servation** :

   * App ‚Üí `/api/bookings/create`
   * Backend ‚Üí cr√©e `booking` (status = `pending`)
   * Notification au prestataire
4. **Confirmation prestataire** :

   * Prestataire confirme ou refuse
   * Si confirm√© ‚Üí `status = confirmed`
   * Activation du chat 1-to-1
5. **Coordination** :

   * Chat int√©gr√© pour d√©tails
   * √âchange coordonn√©es si n√©cessaire
   * N√©gociation prix (si "√† la demande")
6. **Prestation & Paiement** :

   * Service effectu√© hors plateforme
   * Paiement direct (cash, Wave, OM)
   * Prestataire marque `status = completed`
7. **√âvaluation** :

   * Client peut laisser avis et note
   * Am√©liore r√©putation prestataire

---

### ÔøΩ 3.5 CONTRACT GENERATION (Beats & Kits uniquement)

D√®s `status = paid` :

* Backend g√©n√®re contrat PDF contenant :

  * ID transaction
  * Nom vendeur / acheteur
  * Nom produit
  * Montant brut, net, commission
  * Type de licence
  * Date / heure
* Stock√© dans `contracts/{tx_id}.pdf` sur R2
* URL ajout√©e dans `transactions.contract_url`

---

### ÔøΩ 3.6 DOWNLOAD FLOW (Beats & Kits uniquement)

1. App ‚Üí `/api/generate-download` (tx_id)
2. Backend v√©rifie :

   * Transaction "paid"
   * Buyer_id correspond
3. Retourne `presigned GET` R2 (15 min TTL)
4. App lance le t√©l√©chargement.
5. Backend logge dans `download_logs`.

---

### ÔøΩ 3.6bis MESSAGING FLOW (Services uniquement)

1. **Activation** : Chat activ√© uniquement apr√®s confirmation de r√©servation.
2. **Participants** : Client + Prestataire uniquement.
3. **Fonctionnalit√©s** :

   * √âchange de messages texte
   * Partage coordonn√©es (t√©l√©phone, adresse)
   * N√©gociation prix (services "√† la demande")
   * Coordination logistique
4. **Restrictions** :

   * Pas de partage de fichiers audio
   * Pas de liens externes vers autres plateformes
   * Mod√©ration automatique des messages
5. **Fin** : Chat ferm√© apr√®s `status = completed`.

---

### 3.6ter FAVORITES FLOW (Syst√®me de Likes)

1. **Toggle Favorite** : User clique HeartIcon sur Product Card ou Mini Player.
2. **Interface Optimiste** : HeartIcon change imm√©diatement (outline ‚Üí filled).
3. **Synchronisation** : App ‚Üí `/api/favorites` ‚Üí DB update.
4. **Rollback** : Si erreur ‚Üí retour √† l'√©tat pr√©c√©dent + toast.
5. **√âcran Favoris** : Grid 2 colonnes avec tous les beats lik√©s.
6. **Synchronisation Temps R√©el** : WebSocket pour updates multi-device.

---

### 3.6quater PLAYLISTS FLOW (√âditoriales)

#### 3.6quater.1 Admin Flow (Cr√©ation Playlists)

1. **Dashboard Admin** : Gestion des playlists √©ditoriales.
2. **Cr√©ation Playlist** : Titre, description, typebeat, ambiance, BPM.
3. **Ajout Beats** : S√©lection beats selon crit√®res (genre, BPM, tendances).
4. **Ordre** : D√©finir l'ordre des beats dans la playlist.
5. **Publication** : Playlist visible pour tous les users.

#### 3.6quater.2 User Flow (Consommation Playlists)

1. **D√©couverte** : Playlists sur Home Screen et Marketplace.
2. **Lecture** : Tap sur playlist ‚Üí PlaylistDetailScreen.
3. **Player Int√©gr√©** : Lecture continue automatique des beats.
4. **Contr√¥les** : Play/Pause, Next/Previous, Shuffle, Repeat.
5. **Favoris** : HeartIcon pour liker beats depuis playlist.
6. **Achat** : Bouton "Acheter" pour beats non poss√©d√©s.

---

## ÔøΩ 4. CREATOR FLOW (VENDEUR / PRODUCTEUR)

### ÔøΩ 4.1 ACTIVER MODE VENDEUR

* Onglet ‚ÄúPublier‚Äù ‚Üí bouton ‚ÄúActiver la vente‚Äù
* Demande : genre musical, exemple de prod, compte Wave pour paiements
* Si valid√© par admin ‚Üí set `can_sell = true` et `can_withdraw = true`

---

### ÔøΩ 4.2 UPLOAD PRODUIT

1. Onglet "Publier"
2. Choix type : Beat / Kit / Sample / Service
3. Formulaire :

   * Titre
   * Description
   * Prix (beats/kits) ou Tarification (services)
   * Licence (beats/kits uniquement)
   * Tags / BPM / Genre
   * Upload Preview (30 s max, mp3)
   * Upload fichier complet (beats/kits) ou Portfolio (services)
4. Soumission ‚Üí `status = pending`
5. Admin valide ‚Üí `status = active` (visible marketplace)

---

### ÔøΩ 4.2bis CONFIGURATION SERVICES

1. **Type de tarification** :

   * Prix fixe : montant unique
   * √Ä la demande : "Contactez-moi"
   * Multi-tarifs : plusieurs options
2. **Disponibilit√©s** :

   * Calendrier des cr√©neaux
   * Zones g√©ographiques
   * Types de prestations
3. **Portfolio** :

   * Exemples de travaux
   * T√©moignages clients
   * Certifications

---

### ÔøΩ 4.3 DASHBOARD CR√âATEUR

* Onglet "Mes ventes" :

  * Liste des produits (beats/kits)
  * Ventes totales
  * Revenus (wallet)
  * Historique t√©l√©chargements
* Onglet "Mes services" :

  * R√©servations re√ßues
  * Calendrier disponibilit√©s
  * Historique prestations
  * Avis clients
* Onglet "Statistiques" (V2) :

  * Vues, ventes, notes
* Onglet "Retraits" :

  * Solde dispo (beats/kits uniquement)
  * Formulaire demande de retrait (Wave/OM)
  * Validation manuelle admin

---

## ÔøΩ 5. SERVICES FLOW (ING√â SON / STUDIO) - GRATUIT

### ÔøΩ 5.1 PUBLICATION SERVICE

* Type = `service`
* Champs : nom, tarification flexible, description, portfolio
* **Aucune commission** ‚Üí service gratuit pour la plateforme
* Valid√© par admin ‚Üí visible dans cat√©gorie "Services"

### ÔøΩ 5.2 R√âSERVATION SERVICE

* Le client fait une demande ‚Üí `booking` cr√©√©
* Statut = `pending` ‚Üí `confirmed` ‚Üí `completed`
* **Paiement externe** : cash, Wave direct, Orange Money direct
* Chat activ√© pour coordination
* Avis possible apr√®s prestation

---

## ÔøΩ 6. BOOSTS FLOW

### ÔøΩ 6.1 TYPES DE BOOST

| Type    | Dur√©e    | Tarif estim√© |
| :------ | :------- | :----------- |
| Produit | 7 jours  | 2 000 F      |
| Profil  | 14 jours | 5 000 F      |

### ÔøΩ 6.2 PROCESSUS BOOST

1. User clique "Booster ce beat / kit / service / profil"
2. Paiement via `/api/pay-boost`
3. Transaction `type = boost` (commission = 0)
4. Cr√©ation entr√©e dans `boosts`
5. Si `active` ‚Üí √©l√©ment affich√© en haut des listes

---

## ÔøΩ 7. TRANSACTIONS & WALLET FLOW

| Action         | Effet                                         |
| :------------- | :-------------------------------------------- |
| Achat beat/kit | Cr√©e transaction sale, calcule 5 % commission |
| R√©servation service | Cr√©e booking, aucun paiement plateforme    |
| Paiement boost | Cr√©e transaction boost, 0 % commission        |
| T√©l√©chargement | G√©n√®re URL expirable, log                     |
| Retrait        | D√©cr√©mente wallet, cr√©e trace admin           |

---

## ÔøΩ 8. ADMIN FLOW

### ÔøΩ‚ÄçÔøΩ Dashboard

* Voir produits ‚Äúpending‚Äù
* Voir signalements
* Voir transactions / revenus
* G√©rer boosts et paiements

### ÔøΩ Actions

* `validate_product(id)`
* `toggle_capability(user_id, key, value)`
* `mark_withdrawal_paid(id)`
* `moderate_service(id)` (nouveau)
* `resolve_booking_dispute(id)` (nouveau)

---

## ÔøΩ 9. SECURITY FLOW

* Supabase policies v√©rifient capabilities pour :

  * upload, vente, achat, retrait
* JWT enrichi de `capabilities`
* Cloudflare R2 = priv√© par d√©faut
* Presigned URLs TTL courts (5‚Äì15 min)
* Logs download pour audit

---

## ÔøΩ 10. BACKEND ENDPOINTS (vues g√©n√©rales)

| Route                         | Description           | Capability     |
| :---------------------------- | :-------------------- | :------------- |
| `POST /api/upload-request`    | G√©n√®re URL PUT R2     | `can_sell`     |
| `POST /api/upload-complete`   | Cr√©e produit pending  | `can_sell`     |
| `GET /api/products`           | Liste produits actifs | -              |
| `POST /api/pay`               | Paiement Wave/OM (beats/kits) | `can_buy`      |
| `POST /api/generate-download` | Donne URL GET R2      | `can_buy`      |
| `POST /api/boost`             | Paiement boost        | `can_buy`      |
| `GET /api/wallet`             | Voir solde            | `can_withdraw` |
| `POST /api/withdraw`          | Demande retrait       | `can_withdraw` |
| `POST /api/bookings/create`  | Cr√©e r√©servation service | -              |
| `GET /api/bookings`          | Liste r√©servations    | -              |
| `POST /api/conversations/create` | Cr√©e chat service | -              |
| `POST /api/favorites`             | Toggle favorite beat   | -              |
| `GET /api/favorites`              | Liste favoris user    | -              |
| `GET /api/playlists`              | Liste playlists publiques | -          |
| `GET /api/playlists/:id`          | D√©tail playlist + beats | -           |
| `POST /api/admin/playlists`        | Cr√©er playlist (admin) | `admin`        |
| `PUT /api/admin/playlists/:id`     | Modifier playlist (admin) | `admin`    |
| `POST /api/admin/playlists/:id/items` | Ajouter beat √† playlist (admin) | `admin` |

---

## ÔøΩ 11. EVENT LOGS

| √âv√©nement        | Table           |
| :--------------- | :-------------- |
| T√©l√©chargement   | `download_logs` |
| Paiement valid√©  | `transactions`  |
| Boost actif      | `boosts`        |
| Retrait effectu√© | `withdrawals`   |
| R√©servation cr√©√©e | `bookings`     |
| Message envoy√©   | `messages`      |
| Favorite ajout√©  | `favorites`    |
| Playlist cr√©√©e   | `playlists`    |
| Beat ajout√© √† playlist | `playlist_items` |

---

## ÔøΩ 12. FUTURE FLOWS (V2+)

* **Services gratuits + r√©servation** (Phase 1) ‚úÖ
* **Messagerie conditionnelle** (services uniquement) ‚úÖ
* **Syst√®me de favoris** (Phase 1) ‚úÖ
* **Playlists √©ditoriales** (Phase 1) ‚úÖ
* **AI tagging automatique** (genre, BPM)
* **Subscriptions (Pro)** ‚Üí Boosts inclus
* **SODAV integration** ‚Üí D√©claration automatique ≈ìuvres
* **Chat int√©gr√©** (artiste ‚Üî producteur) - **RESTREINT aux services**

---

## ‚úÖ 13. MVP COMPLETION CRITERIA

| Module   | Doit permettre                   |
| :------- | :------------------------------- |
| Auth     | Connexion OTP fonctionnelle      |
| Upload   | Preview + full file sur R2       |
| Vente    | Paiement + commission 5 % (beats/kits) |
| Services | R√©servation gratuite + chat      |
| Download | URL expirable, contrat PDF       |
| Boost    | Paiement + affichage prioritaire |
| Admin    | Validation produits + retraits + services |

---

## üìù Changelog

* **v2.2** - Ajout du syst√®me de favoris et playlists √©ditoriales
* **v2.1** - Ajout du mod√®le services gratuits avec r√©servation et messagerie conditionnelle
* **v1.0** - Version initiale du document de flux
