---
alwaysApply: true
---
# Linkart ‚Äî Frontend Guidelines Document

> Version: v3.0
> Objectif : d√©finir les standards techniques, l'architecture, les conventions UI/UX et les bonnes pratiques de d√©veloppement pour l'application mobile Linkart (React Native + Expo).
> 
> **Architecture v3.0**: Design System centralis√© avec tokens 100% conformes Figma + S√©paration Products/Services avec multi-pricing.

---

## 1. Objectif g√©n√©ral

L‚Äôapplication mobile **Linkart** permet aux artistes, beatmakers, studios et ing√©nieurs du son de vendre des beats, des samples, des kits ou des services (mixage, mastering, enregistrement).
Elle doit √™tre **rapide, modulaire, fiable, coh√©rente visuellement** et facile √† maintenir √† long terme.

---

## 2. Stack technique

| Cat√©gorie              | Outil choisi                   | D√©tails                                             |
| ---------------------- | ------------------------------ | --------------------------------------------------- |
| Framework              | React Native (Expo SDK)        | Build Android & iOS                                 |
| Langage                | TypeScript                     | Typage strict                                       |
| **Styling**            | **Design System + StyleSheet** | **Tokens centralis√©s 100% conforme Figma**          |
| State management       | Zustand                        | L√©ger, scalable, persistant                         |
| Navigation             | React Navigation v7            | Stack + Tab navigators                              |
| Auth                   | Supabase Auth (OTP)            | T√©l√©phone & email                                   |
| API                    | Supabase Edge Functions (REST) | Toutes les op√©rations backend                       |
| T√©l√©versement fichiers | Presigned URLs (R2)            | Via `upload-request`                                |
| Audio                  | expo-av                        | Pr√©-√©coute 30s                                      |
| Animations             | react-native-reanimated        | Animations natives performantes                     |
| Erreurs                | Sentry                         | Crash & logs                                        |
| Linter                 | ESLint + Prettier              | Qualit√© de code                                     |
| Tests UI               | Jest + Testing Library         | Composants cl√©s                                     |
| Storybook              | @storybook/react-native-web-vite | Documentation composants                          |

---

## 3. Architecture du code

```
app/
‚îú‚îÄ‚îÄ components/          # UI partag√©e
‚îÇ   ‚îú‚îÄ‚îÄ atoms/           # Boutons, Inputs, Text
‚îÇ   ‚îú‚îÄ‚îÄ molecules/       # Cards, Player, Forms
‚îÇ   ‚îú‚îÄ‚îÄ organisms/       # Listes, Header, Footer
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ products/        # Beats, kits, samples (payants)
‚îÇ   ‚îú‚îÄ‚îÄ services/        # Professionnels gratuits
‚îÇ   ‚îú‚îÄ‚îÄ bookings/        # Syst√®me de r√©servation
‚îÇ   ‚îú‚îÄ‚îÄ pricing/         # Multi-pricing (licences + tiers)
‚îÇ   ‚îú‚îÄ‚îÄ messaging/       # Chat pour services
‚îÇ   ‚îú‚îÄ‚îÄ wallet/          # Wallet (beats/kits uniquement)
‚îÇ   ‚îú‚îÄ‚îÄ uploads/
‚îÇ   ‚îú‚îÄ‚îÄ boosts/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ hooks/               # Hooks r√©utilisables
‚îú‚îÄ‚îÄ screens/             # Pages principales
‚îÇ   ‚îú‚îÄ‚îÄ HomeScreen.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ProductDetailScreen.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ServiceDetailScreen.tsx
‚îÇ   ‚îú‚îÄ‚îÄ BookingScreen.tsx
‚îÇ   ‚îú‚îÄ‚îÄ UploadScreen.tsx
‚îÇ   ‚îú‚îÄ‚îÄ WalletScreen.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ProfileScreen.tsx
‚îÇ   ‚îî‚îÄ‚îÄ SettingsScreen.tsx
‚îú‚îÄ‚îÄ store/               # Zustand stores
‚îú‚îÄ‚îÄ services/            # Appels API (axios/fetch)
‚îú‚îÄ‚îÄ theme/               # ‚úÖ Design System centralis√©
‚îÇ   ‚îú‚îÄ‚îÄ colors.ts        # Palette Figma compl√®te (100% conforme)
‚îÇ   ‚îú‚îÄ‚îÄ spacing.ts       # xs, sm, md, lg, xl, xxl
‚îÇ   ‚îú‚îÄ‚îÄ typography.ts    # Poppins + Inter, fontSize, lineHeight
‚îÇ   ‚îú‚îÄ‚îÄ radii.ts         # borderRadius variants
‚îÇ   ‚îú‚îÄ‚îÄ shadows.ts       # iOS + Android shadows
‚îÇ   ‚îú‚îÄ‚îÄ helpers.ts       # Fonctions style r√©utilisables
‚îÇ   ‚îî‚îÄ‚îÄ index.ts         # Export central
‚îî‚îÄ‚îÄ App.tsx
```

* Chaque **feature** a ses composants + logique isol√©e.
* Les **stores Zustand** ne doivent jamais contenir de logique r√©seau.
* Les **services/** contiennent uniquement des appels HTTP typ√©s.

---

## 4. Design System v3.0 ‚Äî Tokens Centralis√©s

‚úÖ **100% conforme avec `figma/styles/globals.css`**

### Architecture

```
src/theme/
‚îú‚îÄ‚îÄ colors.ts       # 32 tokens couleur (100% Figma)
‚îú‚îÄ‚îÄ spacing.ts      # 6 tokens spacing
‚îú‚îÄ‚îÄ typography.ts   # Fonts + sizes + weights
‚îú‚îÄ‚îÄ radii.ts        # BorderRadius variants
‚îú‚îÄ‚îÄ shadows.ts      # iOS + Android shadows
‚îú‚îÄ‚îÄ helpers.ts      # Style helpers r√©utilisables
‚îî‚îÄ‚îÄ index.ts        # Export central
```

### R√®gles Strictes

‚ùå **JAMAIS** hardcoder de valeurs :
```typescript
// ‚ùå MAUVAIS
backgroundColor: '#6366F1',
padding: 16,
fontSize: 18,
borderRadius: 24,
```

‚úÖ **TOUJOURS** utiliser les tokens :
```typescript
// ‚úÖ BON
import { colors, spacing, typography, radii } from '@/theme';

const styles = StyleSheet.create({
  container: {
    backgroundColor: colors.primary,
    padding: spacing.md,
    borderRadius: radii.xxl,
  },
  text: {
    fontSize: typography.fontSize.titleMd,
    fontFamily: typography.fontFamily.poppins.semibold,
    color: colors.textPrimary,
  },
});
```

### Palette Compl√®te

```typescript
// Brand Colors
primary: '#6366F1'        // Indigo (actions principales)
secondary: '#F59E0B'      // Orange dor√© (actions secondaires)
accent: '#EC4899'         // Pink (√©l√©ments sp√©ciaux)

// Backgrounds
background: '#0A0A0A'     // Fond principal
surface: '#111111'        // Cards
surfaceElevated: '#1A1A1A' // Surfaces √©lev√©es

// Text
textPrimary: '#F5F5F5'    // Titres
textSecondary: '#D4D4D4'  // Texte corps
textMuted: '#A3A3A3'      // Hints

// UI
border: '#404040'
ring: '#6366F1'           // Focus states
```

üìÑ **Documentation compl√®te** :
- `docs/internal/DESIGN_TOKENS_AUDIT.md` ‚Äî Audit conformit√©
- `.cursor/rules/design-tokens.mdc` ‚Äî R√®gles d'usage
- `docs/internal/FIGMA_TO_RN_MIGRATION_PLAN.md` ‚Äî Plan migration

---

## 5. Composants Design System

### 5.1 Standards de Cr√©ation

**Chaque composant DOIT** :
- ‚úÖ Utiliser les tokens de `@/theme` (jamais de valeurs hardcod√©es)
- ‚úÖ Utiliser `StyleSheet.create()` pour les styles
- ‚úÖ Avoir des animations avec `react-native-reanimated`
- ‚úÖ Avoir une story Storybook
- ‚úÖ √ätre document√© avec JSDoc
- ‚úÖ Avoir des props typ√©es TypeScript

### 5.2 Template de Composant

```typescript
import { StyleSheet } from 'react-native';
import Animated from 'react-native-reanimated';
import { colors, spacing, radii, typography } from '@/theme';

interface MyComponentProps {
  title: string;
  variant?: 'primary' | 'secondary';
  onPress: () => void;
}

export default function MyComponent({
  title,
  variant = 'primary',
  onPress,
}: MyComponentProps) {
  return (
    <Animated.View style={[styles.base, styles[variant]]}>
      {/* ... */}
    </Animated.View>
  );
}

const styles = StyleSheet.create({
  base: {
    padding: spacing.md,
    borderRadius: radii.lg,
  },
  primary: {
    backgroundColor: colors.primary,
  },
  secondary: {
    backgroundColor: colors.secondary,
  },
});
```

### 5.3 Composants Disponibles

#### Atoms (Composants de base)
* `Button` ‚úÖ ‚Äî 4 variants, 3 sizes, animations
* `HeartIcon` ‚Äî Toggle favorite avec animation
* `PlayButton` ‚Äî Bouton play/pause avec variants
* `Input` ‚Äî Champs de formulaire
* `Badge` ‚Äî Badges et tags

#### Molecules (Composants compos√©s)
* `ProductCard` ‚Äî Cards pour beats/kits
* `ServiceCard` ‚Äî Cards pour services professionnels
* `PlaylistCard` ‚Äî Cards pour playlists √©ditoriales
* `MiniPlayer` ‚Äî Player sticky avec heart icon
* `RatingStars` ‚Äî Syst√®me de notation

#### Organisms (Sections compl√®tes)
* `HeroBanner` ‚Äî Grande carte featured avec gradient
* `FilterPills` ‚Äî Filtres scrollables horizontaux
* `TrendingSection` ‚Äî Section horizontale des tendances
* `ServicesSection` ‚Äî Section verticale des services

## 6. R√®gles de Styling

### 6.1 Interdictions Strictes

‚ùå **JAMAIS** :
- Hardcoder des couleurs (`#6366F1`, `rgb(...)`)
- Hardcoder des espacements (`padding: 16`)
- Hardcoder des tailles de font (`fontSize: 18`)
- Hardcoder des borderRadius (`borderRadius: 24`)
- Utiliser des styles inline sauf cas exceptionnel

### 6.2 Bonnes Pratiques

‚úÖ **TOUJOURS** :
- Importer tokens : `import { colors, spacing } from '@/theme'`
- Utiliser `StyleSheet.create()` pour les styles
- Cr√©er des variants avec des cl√©s dynamiques
- Documenter les styles avec des commentaires
- Tester les composants dans Storybook

### 6.3 Exemple Complet

```typescript
import { StyleSheet, View, Text, Pressable } from 'react-native';
import Animated, { useAnimatedStyle } from 'react-native-reanimated';
import { colors, spacing, radii, typography } from '@/theme';

interface CardProps {
  title: string;
  variant?: 'default' | 'elevated';
  onPress?: () => void;
}

export default function Card({ title, variant = 'default', onPress }: CardProps) {
  const animatedStyle = useAnimatedStyle(() => ({
    // Animation logic
  }));

  return (
    <Pressable onPress={onPress}>
      <Animated.View style={[styles.base, styles[variant], animatedStyle]}>
        <Text style={styles.title}>{title}</Text>
      </Animated.View>
    </Pressable>
  );
}

const styles = StyleSheet.create({
  base: {
    padding: spacing.lg,
    borderRadius: radii.lg,
    borderWidth: 1,
    borderColor: colors.border,
  },
  default: {
    backgroundColor: colors.surface,
  },
  elevated: {
    backgroundColor: colors.surfaceElevated,
  },
  title: {
    fontSize: typography.fontSize.titleMd,
    fontFamily: typography.fontFamily.poppins.semibold,
    color: colors.textPrimary,
  },
});
```

---

## 7. Navigation

* Stack principale : `AuthStack`, `MainTabs`, `ProductStack`, `ServiceStack`, `BookingStack`.
* **Nouveaux** : `PlaylistStack`, `FavoritesStack`.
* Redirection automatique vers Home si utilisateur d√©j√† logu√©.
* Routes prot√©g√©es (middleware Auth) pour pages Wallet, Upload, Booking.
* **S√©paration claire** : Products et Services ont des stacks s√©par√©s.

### 7.1 √âcrans Principaux

#### Home Stack
* `HomeScreen` - Dashboard principal avec hero banner, tendances, services
* `PlaylistDetailScreen` - D√©tail playlist avec player int√©gr√©
* `FavoritesScreen` - √âcran des favoris avec grid 2 colonnes

#### Marketplace Stack
* `MarketplaceScreen` - Marketplace avec filtres et tabs
* `ProductDetailScreen` - D√©tail produit avec pricing multi-licences
* `ServiceDetailScreen` - D√©tail service avec pricing multi-tiers

#### Service Stack
* `BookingScreen` - R√©servation de service
* `ChatScreen` - Messagerie pour services
* `BookingHistoryScreen` - Historique des r√©servations

---

## 8. Bonnes pratiques UX

* Transitions fluides, feedback imm√©diat sur actions.
* Utiliser `Toast` de NativeBase pour toutes confirmations/erreurs.
* Loader visible pour actions > 1s.
* Pr√©-√©coute audio max 30s, autoplay interdit.
* Utiliser les ic√¥nes Lucide (`lucide-react-native`).
* **S√©lection de pricing** : Interface claire pour choisir licence/tier.
* **R√©servation** : Processus simple et guid√© pour les services.
* **Messagerie** : Interface intuitive pour le chat des services.
* **Heart Icon** : Animation scale (0.9 ‚Üí 1.1 ‚Üí 1.0) + feedback haptique.
* **Playlists** : Lecture continue automatique avec contr√¥les intuitifs.
* **Favoris** : Interface optimiste avec synchronisation temps r√©el.

---

## 9. Gestion des donn√©es & API

### 9.1 Services

* Tous les appels r√©seau passent par `/services/api.ts` :

```ts
import axios from 'axios';
export const api = axios.create({
  baseURL: process.env.EXPO_PUBLIC_API_URL,
  headers: { 'Content-Type': 'application/json' },
});
```

### 9.2 Exemples d'appels

```ts
// Products (beats/kits)
export const fetchProducts = async () => {
  const { data } = await api.get('/api/products');
  return data;
};

export const fetchProductPricing = async (productId: string) => {
  const { data } = await api.get(`/api/products/${productId}/pricing`);
  return data;
};

// Services (professionnels gratuits)
export const fetchServices = async () => {
  const { data } = await api.get('/api/services');
  return data;
};

export const fetchServicePricing = async (serviceId: string) => {
  const { data } = await api.get(`/api/services/${serviceId}/pricing`);
  return data;
};

// Bookings
export const createBooking = async (bookingData: any) => {
  const { data } = await api.post('/api/bookings/create', bookingData);
  return data;
};

// Messaging
export const sendMessage = async (conversationId: string, content: string) => {
  const { data } = await api.post(`/api/conversations/${conversationId}/messages`, { content });
  return data;
};

// Favorites (Nouveaux)
export const toggleFavorite = async (productId: string) => {
  const { data } = await api.post('/api/favorites', { product_id: productId });
  return data;
};

export const fetchFavorites = async () => {
  const { data } = await api.get('/api/favorites');
  return data;
};

// Playlists (Nouveaux)
export const fetchPlaylists = async () => {
  const { data } = await api.get('/api/playlists');
  return data;
};

export const fetchPlaylistDetail = async (playlistId: string) => {
  const { data } = await api.get(`/api/playlists/${playlistId}`);
  return data;
};
```

### 9.3 Erreurs

* Catch global avec `Toast.show()` + log Sentry.
* **Validation pricing** : V√©rifier que pricing_id existe avant paiement.
* **Validation booking** : V√©rifier que service est disponible avant r√©servation.
* **Interface optimiste** : Mise √† jour imm√©diate pour favoris avec rollback en cas d'erreur.

---

## 10. Authentification

* Auth par OTP (t√©l√©phone ou email).
* Lors de la premi√®re connexion ‚Üí cr√©ation profil minimal (`users` table).
* Stocker `session` dans Zustand (persist√©e via AsyncStorage).
* Token JWT est inject√© automatiquement dans `axios` headers.
* **Capabilities** : `can_buy`, `can_sell`, `can_offer_services`, `can_withdraw`.
* **Nouvelles capabilities** : `can_create_playlists` (admin uniquement).

---

## 11. Gestion du m√©dia

* Upload via `/api/upload-request` ‚Üí obtention URL PUT.
* Le fichier complet (zip/mp3) envoy√© sur R2, preview 30s max.
* Lien de t√©l√©chargement presign√© g√©n√©r√© apr√®s paiement.
* **Services** : Portfolio (mp3) pour d√©monstration des comp√©tences.
* **Products** : Fichier complet (zip) pour t√©l√©chargement apr√®s achat.
* **Playlists** : Covers g√©n√©r√©es (gradient + icon) ou upload√©es.
* **Favoris** : Pas de fichiers, juste r√©f√©rences aux produits.

---

## 12. Performances

* Pagination infinie (FlatList avec `onEndReached`).
* Lazy load images avec `expo-image`.
* Utiliser `React.memo` et `useCallback` sur les listes longues.
* Bundles optimis√©s avec EAS Build.
* **Pricing** : Cache des options de pricing pour √©viter les appels r√©p√©t√©s.
* **Bookings** : Pagination des r√©servations et messages.
* **Favoris** : Cache local avec synchronisation diff√©rentielle.
* **Playlists** : Cache des playlists avec invalidation intelligente.
* **Animations** : Native driver pour les animations fluides.

---

## 13. S√©curit√©

* Ne jamais stocker les cl√©s API ou service key localement.
* Utiliser variables `EXPO_PUBLIC_*` et config `.env`.
* T√©l√©chargement uniquement via presigned URLs (15 min).
* Nettoyage des states sensibles au logout.
* **Pricing** : Validation c√¥t√© client ET serveur des pricing_id.
* **Messaging** : V√©rification que l'utilisateur peut acc√©der √† la conversation.
* **Bookings** : V√©rification des permissions avant cr√©ation de r√©servation.
* **Favoris** : Validation que l'utilisateur peut liker le produit.
* **Playlists** : V√©rification des permissions admin pour cr√©ation/modification.

---

## 14. Tests

| Type | Outil           | Description                    |
| ---- | --------------- | ------------------------------ |
| Unit | Jest            | Test des hooks et stores       |
| UI   | Testing Library | Test composants interactifs    |
| **Design System** | **Storybook + Visual** | **Test variants, animations, tokens** |
| E2E  | Playwright      | Sc√©narios achat, upload, login |
| **Multi-pricing** | Jest | Test s√©lection licence/tier |
| **Booking** | Testing Library | Test flow r√©servation |
| **Messaging** | Testing Library | Test interface chat |
| **Favoris** | Testing Library | Test toggle favorite et sync |
| **Playlists** | Testing Library | Test lecture continue et contr√¥les |

### 14.1 Tests Design System

**Chaque composant doit avoir** :
- ‚úÖ Story Storybook avec tous les variants
- ‚úÖ Tests Jest pour la logique (si applicable)
- ‚úÖ Tests visuels (Storybook Web)
- ‚úÖ V√©rification conformit√© tokens (pas de hardcoding)

**Exemple de test** :
```typescript
describe('Button', () => {
  it('should use design tokens', () => {
    const { getByText } = render(<Button title="Test" onPress={jest.fn()} />);
    const button = getByText('Test').parent;
    // V√©rifier que les styles utilisent les tokens
    expect(button?.props.style).toMatchObject({
      backgroundColor: colors.primary,
    });
  });
});
```

---

## 15. Accessibilit√©

* Tous les boutons doivent avoir `accessibilityLabel`.
* Texte lisible en dark/light mode.
* Support clavier et lecteurs d'√©cran sur Android/iOS.
* **Pricing** : Labels clairs pour les options de licence/tier.
* **Booking** : Instructions vocales pour le processus de r√©servation.
* **Messaging** : Support des lecteurs d'√©cran pour les messages.
* **Heart Icon** : Labels pour les √©tats favori/non-favori.
* **Playlists** : Navigation claire entre les beats de la playlist.
* **Animations** : Respect des pr√©f√©rences `prefers-reduced-motion`.

---

## 16. CI/CD mobile

* Build via **EAS Build** sur chaque tag.
* Version bump auto via `expo-version`.
* Tests ex√©cut√©s avant build.
* Upload sur Play Store / TestFlight via EAS submit.
* **Tests multi-pricing** ex√©cut√©s avant d√©ploiement.
* **Tests booking/messaging** ex√©cut√©s avant d√©ploiement.
* **Tests favoris/playlists** ex√©cut√©s avant d√©ploiement.
* **Tests design system** ex√©cut√©s avant d√©ploiement.

---

## 17. R√©capitulatif Design System v3.0

### ‚úÖ Conformit√© Figma : 100%

Notre Design System est **100% conforme** avec `figma/styles/globals.css` :
- ‚úÖ **32 tokens couleur** align√©s
- ‚úÖ **6 tokens spacing** identiques
- ‚úÖ **Typography Poppins + Inter** exacte
- ‚úÖ **BorderRadius** variants conformes

### üì¶ Avantages

1. **Coh√©rence visuelle** : Tous les composants utilisent les m√™mes valeurs
2. **Maintenabilit√©** : Changer une couleur = impact global
3. **Performance** : StyleSheet.create natif (pas de CSS-in-JS)
4. **Type Safety** : TypeScript pour √©viter les erreurs
5. **Scalabilit√©** : Facile d'ajouter de nouveaux tokens
6. **Storybook** : Documentation interactive des composants

### üìö Documentation Compl√®te

- `docs/internal/DESIGN_TOKENS_AUDIT.md` ‚Äî Audit conformit√© 100%
- `docs/internal/FIGMA_TO_RN_MIGRATION_PLAN.md` ‚Äî Plan migration
- `.cursor/rules/design-tokens.mdc` ‚Äî R√®gles d'usage strictes
- Storybook Web ‚Äî Documentation interactive (http://localhost:6006)

### üöÄ Prochains Composants

Suivre le pattern Button pour cr√©er :
1. Input + InputField
2. Card + CardHeader + CardContent
3. Label, Textarea, Select
4. Dialog, Sheet (modals)
5. Tabs, Checkbox, Radio, Switch

**Template disponible** dans section 5.2 de ce document.

---

## 18. Futur (phases suivantes)

* Mode offline (caching produits et services).
* Th√®me sombre auto.
* Multi-langue (i18n + fr/en).
* Notifications push (Expo Push API).
* Dashboard web React (admin).
* **Services avanc√©s** : Calendrier int√©gr√©, notifications de r√©servation.
* **Messagerie avanc√©e** : Partage de fichiers, appels vocaux.
* **Pricing dynamique** : Suggestions de prix bas√©es sur le march√©.
* **Playlists intelligentes** : G√©n√©ration automatique par IA.
* **Favoris avanc√©s** : Cat√©gories, partage, export.
* **Analytics** : Dashboard utilisateur avec statistiques.


