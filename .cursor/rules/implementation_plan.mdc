---
alwaysApply: true
---
## 2. Objectif MVP

### Livrables prioritaires (MVP)

1. **Compte utilisateur** (auth OTP via Supabase)
2. **Profils** avec capabilities : `can_buy`, `can_sell`
3. **Catalogue produits** (beats, samples, kits) avec multi-licences
4. **Catalogue services** (mixage, mastering, enregistrement) avec multi-tiers
5. **Paiement intégré (Wave / OM)** avec commission 5% sur beats/kits uniquement
6. **Système de réservation** pour services (gratuit)
7. **Téléchargement sécurisé via URL presignée** (beats/kits uniquement)
8. **Système de wallet et retraits manuels** (beats/kits uniquement)
9. **Mécanisme de boost payant** (produit, service ou profil)
10. **Système de notation** (ratings pour produits et services)
11. **Messagerie conditionnelle** (services uniquement)
12. **Back-office admin minimal** (approbation produits/services, retraits)

---

## 3. Phase 1 — Infrastructure & Base technique

### 3.1 Backend setup

* [ ] Créer projet Supabase (auth + db)
* [ ] Configurer R2 Cloudflare (buckets : `beats`, `previews`, `contracts`)
* [ ] Créer tables selon `backend_structure_document.mdc` :
  * Tables séparées : `products` + `product_pricing` (beats/kits)
  * Tables séparées : `services` + `service_pricing` (professionnels)
  * Tables booking : `bookings`, `conversations`, `messages`
* [ ] Configurer RLS policies (auth.uid, capabilities)
* [ ] Créer fonctions Edge principales :
  * `/upload-request`
  * `/upload-complete`
  * `/pay` (beats/kits uniquement avec pricing_id)
  * `/generate-download` (beats/kits uniquement)
  * `/boost`
  * `/withdraw` (beats/kits uniquement)
  * `/bookings/create` (services uniquement)
  * `/bookings/confirm`
  * `/conversations/create` (services uniquement)
  * `/messages/send` (services uniquement)
* [ ] CI/CD GitHub Actions : migrations + functions deploy

### 3.2 Frontend setup

* [x] Expo project init (TypeScript)
* [x] Setup NativeBase + NativeWind
* [x] Créer thème global (`colors.ts`, `theme/index.ts`)
* [x] Navigation (AuthStack, MainTabs, ProductStack)
* [x] Setup Zustand store
* [x] Services axios (API layer)
* [x] Setup Sentry & .env config
* [x] Bibliothèque de composants (Atoms, Molecules, Organisms)
* [x] Configuration de Storybook pour la documentation visuelle

### 3.3 Tooling & pipeline

* [x] ESLint + Prettier + TypeScript strict
* [ ] GitHub Actions lint/test
* [x] Jest + Testing Library config
* [ ] Supabase CLI + local serve

---

## 4. Phase 2 — Core Features

### 4.1 Upload & produit

* [x] UI Upload (formulaire beat/sample/service)
* [ ] Edge Function `/upload-request` → presigned PUT
* [ ] Edge Function `/upload-complete` → insert product/service (status=pending)
* [ ] UI sélection multi-licences pour beats/kits
* [ ] UI sélection multi-tiers pour services
* [ ] Admin validation (manual)

### 4.2 Achat & paiement (beats/kits uniquement)

* [ ] Flow achat produit avec sélection licence
* [ ] Function `/pay` → transaction pending (avec pricing_id)
* [ ] Webhook paiement → status=paid → wallet update
* [ ] Génération contrat PDF + R2 upload
* [ ] Function `/generate-download` → URL presignée (15 min)
* [ ] Téléchargement fichier (preview 30s / complet payant)

### 4.3 Services & réservation (gratuit)

* [ ] Flow réservation service avec sélection tier
* [ ] Function `/bookings/create` → booking pending
* [ ] Function `/bookings/confirm` → booking confirmed
* [ ] Activation messagerie automatique
* [ ] Function `/conversations/create` + `/messages/send`
* [ ] Finalisation service (paiement externe)

### 4.4 Wallet & retraits (beats/kits uniquement)

* [ ] Function `/withdraw`
* [ ] Admin validation (manual)
* [ ] Mise à jour wallet
* [ ] Historique retraits

### 4.5 Boosts

* [ ] Function `/boost` → transaction type=boost
* [ ] Classement boosté sur `/api/products` et `/api/services`
* [ ] UI boost avec durée/prix

### 4.6 Ratings

* [x] Table `ratings` (déjà ajoutée)
* [ ] Edge Function `/ratings/create` (produits ET services)
* [x] Affichage moyenne sur produit/service et profil
* [ ] Modération admin

---

## 5. Phase 3 — UI/UX polish

* [ ] Loader, feedback visuel cohérent (React Native Paper Toast)
* [x] Design système uniforme (typographie, spacing)
* [x] Player audio fluide (expo-av)
* [ ] Gestion d’erreurs centralisée (hook useErrorHandler)
* [ ] Écran onboarding & profil setup
* [ ] Traductions (fr/en)
* [ ] Mode sombre

---

## 6. Phase 4 — Admin & outils internes

* [ ] Dashboard admin minimal (Supabase Studio ou React Web)
* [ ] CRUD : produits, services, transactions, retraits, utilisateurs
* [ ] Filtrage produits/services par statut (pending/active/rejected)
* [ ] Suivi des revenus plateforme (beats/kits uniquement)
* [ ] Gestion des réservations et disputes
* [ ] Export CSV (revenus, transactions, retraits)

---

## 7. Phase 5 — Intégrations futures

| Intégration               | Description                                                 | Priorité       |
| ---- | ----- | ----- |
| **SODAV Monitor**         | Lier métadonnées produits à système de suivi des diffusions | ⚙️ Moyen terme |
| **SODAV TeleDéclaration** | Déclaration automatique des œuvres vendues                  | ⚙️ Moyen terme |
| **AI tagging**            | Analyse automatique du BPM, genre, tonalité des beats       | ⚙️ Long terme  |
| **API publique**          | Pour intégration avec autres apps musicales                 | ⚙️ Long terme  |

---

## 8. Sécurité et conformité

* RLS activé sur toutes les tables sensibles
* Auth via Supabase JWT
* URLs presignées avec TTL
* Hashing des IP dans `download_logs`
* Sauvegardes automatiques quotidiennes (DB + R2 index)
* Logs Sentry + alertes erreurs critiques
* Mentions légales et CGU (à ajouter avant déploiement public)

---

## 9. Roadmap temporelle

| Phase   | Durée estimée | Responsable    | Livrables             |
| :--- | :--- | :---- | :----- |
| Phase 1 | 3 semaines    | Backend lead   | Infra + base code     |
| Phase 2 | 5 semaines    | Fullstack team | Core features         |
| Phase 3 | 2 semaines    | Frontend/UI    | UI & expérience       |
| Phase 4 | 2 semaines    | Admin/DevOps   | Back-office           |
| Phase 5 | 3 semaines+   | R&D            | Intégrations avancées |

---

## 10. MVP Checklist

* [ ] Auth fonctionnelle (OTP)
* [x] Upload produit/service avec preview
* [ ] Multi-pricing : licences pour beats/kits, tiers pour services
* [ ] Paiement 5% commission (beats/kits uniquement)
* [ ] Système de réservation (services gratuits)
* [ ] Messagerie conditionnelle (services uniquement)
* [ ] Téléchargement sécurisé (beats/kits uniquement)
* [x] Wallet opérationnel (beats/kits uniquement)
* [x] Boost actif (produits/services/profils)
* [x] Notation active (produits/services)
* [ ] Admin valide produit/service & retrait
* [x] Logs & Sentry en place
* [ ] CI/CD opérationnel

---

## 11. Livraison & post-MVP

### Cible :

* **Alpha test** : beatmakers & ingénieurs proches du réseau
* **Beta publique** : sélection d’artistes sénégalais
* **Production** : ouverture à tous les créateurs audio en Afrique francophone

### Post-MVP focus :

* UX améliorée
* Retrait instantané via API Wave/OM
* Reco AI (top beats, profils)
* Publication automatique sur réseaux sociaux