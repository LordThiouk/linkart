/* do not change this file, it is auto generated by storybook. */

console.log('üìö [Storybook Requires] D√©but du chargement de storybook.requires.ts...');

import { start, updateView } from '@storybook/react-native';

console.log('üìö [Storybook Requires] Imports de @storybook/react-native OK');

import '@storybook/addon-ondevice-controls/register';
// Note: @storybook/addon-ondevice-actions retir√© car il g√©n√®re un preview inexistant

console.log('üìö [Storybook Requires] Addons enregistr√©s');

const normalizedStories = [
  {
    titlePrefix: '',
    directory: './.rnstorybook/stories',
    files: '**/*.stories.?(ts|tsx|js|jsx)',
    importPathMatcher: /^\.(?:(?:^|\/|(?:(?:(?!(?:^|\/)\.).)*?)\/)(?!\.)(?=.)[^/]*?\.stories\.(?:ts|tsx|js|jsx)?)$/,
    // @ts-ignore
    req: require.context(
      './stories',
      true,
      /^\.(?:(?:^|\/|(?:(?:(?!(?:^|\/)\.).)*?)\/)(?!\.)(?=.)[^/]*?\.stories\.(?:ts|tsx|js|jsx)?)$/
    ),
  },
];

declare global {
  var view: ReturnType<typeof start>;
  var STORIES: typeof normalizedStories;
}

const annotations = [
  require('./preview'),
  require('@storybook/react-native/dist/preview'),
  // Note: @storybook/addon-ondevice-actions n'a pas de fichier preview
  // Il est enregistr√© via register.js qui est d√©j√† import√© au-dessus
];

global.STORIES = normalizedStories;

// @ts-ignore
module?.hot?.accept?.();

console.log('üìö [Storybook Requires] Initialisation de Storybook...');
console.log('üìö [Storybook Requires] normalizedStories:', normalizedStories.length, 'entries');
console.log('üìö [Storybook Requires] annotations:', annotations.length, 'entries');

try {
  if (!global.view) {
    console.log('üìö [Storybook Requires] Cr√©ation de global.view...');
    global.view = start({
      annotations,
      storyEntries: normalizedStories,
    });
    console.log('‚úÖ [Storybook Requires] global.view cr√©√©');
  } else {
    console.log('üìö [Storybook Requires] Mise √† jour de global.view...');
    updateView(global.view, annotations, normalizedStories);
    console.log('‚úÖ [Storybook Requires] global.view mis √† jour');
  }
} catch (error) {
  console.error("‚ùå [Storybook Requires] Erreur lors de l'initialisation:", error);
  if (error instanceof Error) {
    console.error('‚ùå [Storybook Requires] Error type:', error.constructor.name);
    console.error('‚ùå [Storybook Requires] Error message:', error.message);
    console.error('‚ùå [Storybook Requires] Error stack:', error.stack);
  }
  throw error;
}

export const view = global.view;
